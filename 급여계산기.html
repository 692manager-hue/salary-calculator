<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸‰ì—¬ ê³„ì‚°ê¸° - ë†ì—…íšŒì‚¬ë²•ì¸(ì£¼)ìœ¡êµ¬ì´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 15px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            color: #3498db;
            border-bottom: 3px solid #3498db;
            margin-bottom: -2px;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .input-group input, .input-group select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-calculate {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .result-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .result-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .result-item.highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .result-item .label {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }

        .result-item.highlight .label {
            color: rgba(255,255,255,0.8);
        }

        .result-item .value {
            font-size: 22px;
            font-weight: bold;
            color: #2c3e50;
        }

        .result-item.highlight .value {
            color: white;
        }

        .total-section {
            margin-top: 20px;
            padding: 25px;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            border-radius: 15px;
            text-align: center;
            color: white;
        }

        .total-section .label {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .total-section .value {
            font-size: 36px;
            font-weight: bold;
        }

        .minimum-wage-check {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }

        .minimum-wage-check.pass {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .minimum-wage-check.fail {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .settings-row {
            display: flex;
            gap: 20px;
            align-items: center;
            padding: 15px;
            background: #fff3cd;
            border-radius: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .settings-row label {
            font-weight: bold;
            color: #856404;
        }

        .settings-row input {
            padding: 10px;
            border: 2px solid #ffc107;
            border-radius: 8px;
            width: 150px;
            font-size: 15px;
        }

        .settings-row .info {
            font-size: 12px;
            color: #856404;
        }

        /* ì§ì› ê´€ë¦¬ í…Œì´ë¸” */
        .employee-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .employee-table th, .employee-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .employee-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }

        .employee-table tr:hover {
            background: #f8f9fa;
        }

        .history-manage-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .history-manage-table th, .history-manage-table td {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
            text-align: left;
        }

        .history-manage-table th {
            background: #f8f9fa;
            font-weight: bold;
        }

        .history-manage-table .btn {
            padding: 3px 8px;
            font-size: 11px;
            margin-right: 3px;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }

        .badge-up {
            background: #d4edda;
            color: #155724;
        }

        .badge-down {
            background: #f8d7da;
            color: #721c24;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .modal-close {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .modal-close:hover {
            color: #333;
        }

        /* ê·¼ë¡œê³„ì•½ì„œ ì¶œë ¥ ìŠ¤íƒ€ì¼ */
        .contract-preview {
            background: white;
            padding: 30px;
            border: 1px solid #ccc;
            margin-top: 20px;
            font-size: 13px;
            line-height: 1.5;
        }

        .contract-preview h2 {
            text-align: center;
            font-size: 22px;
            margin-bottom: 20px;
            letter-spacing: 8px;
        }

        .contract-preview p {
            margin: 6px 0;
        }

        .contract-preview .indent {
            padding-left: 20px;
        }

        .contract-preview .indent2 {
            padding-left: 40px;
        }

        .contract-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .contract-table th, .contract-table td {
            border: 1px solid #333;
            padding: 6px 8px;
            font-size: 12px;
        }

        .contract-table th {
            background: #f0f0f0;
            font-weight: normal;
        }

        @media print {
            @page {
                size: A4;
                margin: 8mm;
            }
            body {
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            body > *:not(.container) {
                display: none !important;
            }
            .container {
                box-shadow: none !important;
                border-radius: 0 !important;
                max-width: none !important;
                background: white !important;
            }
            .header, .tabs, .section, .modal, #tab-employees {
                display: none !important;
            }
            #tab-calculator {
                display: block !important;
                padding: 0 !important;
            }
            #tab-calculator > *:not(#resultArea) {
                display: none !important;
            }
            #resultArea {
                display: block !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            #resultArea > *:not(#contractPreviewArea) {
                display: none !important;
            }
            #contractPreviewArea {
                display: block !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            .contract-preview {
                border: none !important;
                padding: 0 !important;
                margin: 0 !important;
                font-size: 9px;
                line-height: 1.25;
            }
            .contract-preview h2 {
                font-size: 14px;
                margin-bottom: 8px;
                letter-spacing: 5px;
            }
            .contract-preview p {
                margin: 2px 0;
            }
            .contract-preview .indent {
                padding-left: 12px;
            }
            .contract-preview .indent2 {
                padding-left: 24px;
            }
            .contract-preview .contract-table {
                margin: 4px 0;
            }
            .contract-preview .contract-table th,
            .contract-preview .contract-table td {
                padding: 2px 4px;
                font-size: 8.5px;
            }
            .contract-preview .signature-section {
                margin-top: 10px;
            }
            .contract-preview div[style*="margin-top"] {
                margin-top: 8px !important;
            }
            .contract-preview {
                overflow: visible !important;
            }
            .contract-preview p, .contract-preview span {
                overflow: visible !important;
            }
            .print-btn-area {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ê¸‰ì—¬ ê³„ì‚°ê¸°</h1>
            <p>ë†ì—…íšŒì‚¬ë²•ì¸(ì£¼)ìœ¡êµ¬ì´</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('calculator')">ê¸‰ì—¬ ê³„ì‚°</button>
            <button class="tab" onclick="showTab('employees')">ì§ì› ê´€ë¦¬</button>
        </div>

        <!-- ê¸‰ì—¬ ê³„ì‚° íƒ­ -->
        <div id="tab-calculator" class="tab-content active">
            <div class="settings-row">
                <label>1ì‹ ë‹¨ê°€:</label>
                <input type="number" id="dailyMealCost" value="8000" min="0" step="1000">
                <span class="info">ì›</span>
                <label style="margin-left: 20px;">ì¼ ì§€ê¸‰íšŸìˆ˜:</label>
                <select id="mealsPerDay" style="padding:10px; border:2px solid #ffc107; border-radius:8px; font-size:15px;">
                    <option value="0">ë¯¸ì§€ê¸‰</option>
                    <option value="1" selected>1íšŒ</option>
                    <option value="2">2íšŒ</option>
                    <option value="3">3íšŒ</option>
                </select>
                <span class="info">(ê¸°íƒ€ìˆ˜ë‹¹ ê³„ì‚°ì— ì‚¬ìš©)</span>
                <label style="margin-left: 30px;">ìµœì €ì‹œê¸‰:</label>
                <input type="number" id="minimumWage" value="10030" min="0" step="10">
                <span class="info">ì›</span>
            </div>

            <div class="section">
                <div class="section-title">ê¸°ë³¸ ì •ë³´ ì…ë ¥</div>
                <div class="input-grid">
                    <div class="input-group">
                        <label>ì´ë¦„</label>
                        <input type="text" id="name" placeholder="ì§ì› ì´ë¦„">
                    </div>
                    <div class="input-group">
                        <label>ê³„ì•½ì›”ê¸‰ (ì›)</label>
                        <input type="number" id="contractSalary" placeholder="ì˜ˆ: 3000000" min="0">
                        <span style="font-size: 11px; color: #888; margin-top: 3px;">ë¹„ê³¼ì„¸ ê¸ˆì•¡ í¬í•¨í•œ ì´ ì›”ê¸‰</span>
                    </div>
                    <div class="input-group">
                        <label>ì¶œê·¼ì‹œê°„</label>
                        <input type="time" id="startTime" value="08:00">
                    </div>
                    <div class="input-group">
                        <label>í‡´ê·¼ì‹œê°„</label>
                        <input type="time" id="endTime" value="17:00">
                    </div>
                    <div class="input-group">
                        <label>íœ´ê²Œì‹œê°„</label>
                        <select id="breakTime">
                            <option value="0.5">30ë¶„</option>
                            <option value="1" selected>1ì‹œê°„</option>
                            <option value="1.5">1ì‹œê°„ 30ë¶„</option>
                            <option value="2">2ì‹œê°„</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>ì›” íœ´ë¬´ì¼ìˆ˜</label>
                        <select id="monthlyOffDays">
                            <option value="4">4ì¼ (ì£¼1íšŒ)</option>
                            <option value="5">5ì¼</option>
                            <option value="6">6ì¼</option>
                            <option value="7">7ì¼</option>
                            <option value="8" selected>8ì¼ (ì£¼2íšŒ)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">ë¹„ê³¼ì„¸ í•­ëª© ì…ë ¥</div>
                <div class="input-grid">
                    <div class="input-group">
                        <label>ì‹ëŒ€ (ì›)</label>
                        <input type="number" id="mealAllowance" value="200000" min="0">
                    </div>
                    <div class="input-group">
                        <label>ì°¨ëŸ‰ìœ ì§€ë¹„ (ì›)</label>
                        <input type="number" id="vehicleAllowance" value="0" min="0">
                    </div>
                    <div class="input-group">
                        <label>ìœ¡ì•„ìˆ˜ë‹¹ (ì›)</label>
                        <input type="number" id="childcareAllowance" value="0" min="0">
                    </div>
                    <div class="input-group">
                        <label>ì—°êµ¬ìˆ˜ë‹¹ (ì›)</label>
                        <input type="number" id="researchAllowance" value="0" min="0">
                    </div>
                </div>
            </div>

            <button class="btn btn-primary btn-calculate" onclick="calculate()">ê¸‰ì—¬ ê³„ì‚°í•˜ê¸°</button>

            <div id="resultArea" style="display: none;">
                <div class="result-section">
                    <div class="section-title">ê¸‰ì—¬ ê³„ì‚° ê²°ê³¼</div>
                    <div class="result-grid">
                        <div class="result-item highlight">
                            <div class="label">ê¸°ë³¸ê¸‰ (ê¸°ë³¸ê¸‰+ì£¼íœ´ìˆ˜ë‹¹)</div>
                            <div class="value" id="resultBaseSalary">0</div>
                        </div>
                        <div class="result-item">
                            <div class="label">ì—°ì¥ìˆ˜ë‹¹</div>
                            <div class="value" id="resultOvertimePay">0</div>
                        </div>
                        <div class="result-item">
                            <div class="label">íœ´ì¼ìˆ˜ë‹¹</div>
                            <div class="value" id="resultHolidayPay">0</div>
                        </div>
                        <div class="result-item">
                            <div class="label">íœ´ì¼ì—°ì¥ìˆ˜ë‹¹</div>
                            <div class="value" id="resultHolidayOvertimePay">0</div>
                        </div>
                        <div class="result-item">
                            <div class="label">ê¸°íƒ€ìˆ˜ë‹¹</div>
                            <div class="value" id="resultMealExtra">0</div>
                        </div>
                        <div class="result-item">
                            <div class="label">ì‹ëŒ€</div>
                            <div class="value" id="resultMeal">0</div>
                        </div>
                        <div class="result-item">
                            <div class="label">ì°¨ëŸ‰ìœ ì§€ë¹„</div>
                            <div class="value" id="resultVehicle">0</div>
                        </div>
                        <div class="result-item">
                            <div class="label">ìœ¡ì•„ìˆ˜ë‹¹</div>
                            <div class="value" id="resultChildcare">0</div>
                        </div>
                        <div class="result-item">
                            <div class="label">ì—°êµ¬ìˆ˜ë‹¹</div>
                            <div class="value" id="resultResearch">0</div>
                        </div>
                    </div>

                    <div class="total-section">
                        <div class="label">ì´ ê¸‰ì—¬ (ê³„ì•½ì›”ê¸‰ + ê¸°íƒ€ìˆ˜ë‹¹)</div>
                        <div class="value" id="resultTotal">0ì›</div>
                    </div>

                    <div id="minimumWageCheck" class="minimum-wage-check pass">
                        ìµœì €ì„ê¸ˆ ê²€ì¦: í†µìƒì‹œê¸‰ 0ì› (ìµœì €ì„ê¸ˆ ì´ìƒ)
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-success" onclick="saveEmployee()">ì§ì› ì •ë³´ ì €ì¥</button>
                        <button class="btn btn-info" onclick="showContractModal()">ê·¼ë¡œê³„ì•½ì„œ ì‘ì„±</button>
                    </div>
                </div>

                <!-- ë„ì¥ ì´ë¯¸ì§€ ê´€ë¦¬ -->
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <label style="font-weight: bold; margin-bottom: 10px; display: block;">ì‚¬ì—…ì²´ ë„ì¥ ì´ë¯¸ì§€</label>
                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <div id="stampPreview" style="width: 80px; height: 80px; border: 2px dashed #ccc; border-radius: 8px; display: flex; align-items: center; justify-content: center; overflow: hidden; background: white;">
                            <span style="color: #999; font-size: 12px; text-align: center;">ë„ì¥ ì—†ìŒ</span>
                        </div>
                        <div>
                            <input type="file" id="stampInput" accept="image/*" style="display: none;" onchange="handleStampUpload(event)">
                            <button class="btn btn-secondary" style="padding: 8px 15px; font-size: 13px;" onclick="document.getElementById('stampInput').click()">ì´ë¯¸ì§€ ì„ íƒ</button>
                            <button class="btn btn-danger" style="padding: 8px 15px; font-size: 13px; margin-left: 5px;" onclick="removeStamp()">ì‚­ì œ</button>
                        </div>
                        <span style="font-size: 12px; color: #666;">ê¶Œì¥: ì •ì‚¬ê°í˜• PNG ì´ë¯¸ì§€ (íˆ¬ëª… ë°°ê²½)</span>
                    </div>
                </div>

                <!-- ê·¼ë¡œê³„ì•½ì„œ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ -->
                <div id="contractPreviewArea" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- ì§ì› ê´€ë¦¬ íƒ­ -->
        <div id="tab-employees" class="tab-content">
            <div class="section">
                <div class="section-title">ì§ì› ëª©ë¡</div>
                <div id="employeeList">
                    <table class="employee-table">
                        <thead>
                            <tr>
                                <th>ì´ë¦„</th>
                                <th>ì…ì‚¬ì¼</th>
                                <th>í˜„ì¬ ê³„ì•½ì›”ê¸‰</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="employeeTableBody">
                            <tr>
                                <td colspan="4" style="text-align: center; color: #999;">ì €ì¥ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="exportEmployeeData()">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
                    <input type="file" id="importFile" style="display:none" accept=".json" onchange="importEmployeeData(event)">
                </div>
            </div>
        </div>

    </div>

    <!-- ê¸‰ì—¬/ê·¼ë¬´ì¡°ê±´ ë³€ê²½ ëª¨ë‹¬ -->
    <div id="salaryModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <span class="modal-close" onclick="closeSalaryModal()">&times;</span>
            <div class="modal-header">ê·¼ë¬´ì¡°ê±´ ë³€ê²½</div>
            <input type="hidden" id="modalEmployeeId">
            <div class="input-group" style="margin-bottom: 15px;">
                <label>ë³€ê²½ ì ìš©ì¼</label>
                <input type="date" id="modalChangeDate">
            </div>
            <div class="input-group" style="margin-bottom: 15px;">
                <label>ê³„ì•½ì›”ê¸‰ (ì›)</label>
                <input type="text" id="modalNewSalary" placeholder="ë³€ê²½í•  ê¸ˆì•¡">
            </div>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <div class="input-group" style="flex: 1;">
                    <label>ì¶œê·¼ì‹œê°„</label>
                    <input type="time" id="modalStartTime" style="padding: 10px;">
                </div>
                <div class="input-group" style="flex: 1;">
                    <label>í‡´ê·¼ì‹œê°„</label>
                    <input type="time" id="modalEndTime" style="padding: 10px;">
                </div>
            </div>
            <div class="input-group" style="margin-bottom: 15px;">
                <label>ì›” íœ´ë¬´ì¼ìˆ˜</label>
                <select id="modalMonthlyOffDays" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    <option value="4">4ì¼ (ì£¼1íšŒ)</option>
                    <option value="5">5ì¼</option>
                    <option value="6">6ì¼</option>
                    <option value="7">7ì¼</option>
                    <option value="8">8ì¼ (ì£¼2íšŒ)</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="updateEmployeeSalary()">ë³€ê²½ ì €ì¥</button>
        </div>
    </div>

    <!-- ê·¼ë¬´ì¡°ê±´ ì´ë ¥ ê´€ë¦¬ ëª¨ë‹¬ -->
    <div id="historyModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="modal-close" onclick="closeHistoryModal()">&times;</span>
            <div class="modal-header">ì´ë ¥ ê´€ë¦¬</div>
            <input type="hidden" id="modalHistoryEmployeeId">

            <!-- ì…ì‚¬ì¼ ì„¹ì…˜ -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <div style="font-weight: bold; margin-bottom: 10px; color: #2c3e50;">ğŸ“… ì…ì‚¬ ì •ë³´</div>
                <div style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                    <div class="input-group" style="flex: 1; min-width: 150px;">
                        <label>ì…ì‚¬ì¼</label>
                        <input type="date" id="historyHireDate" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    <div class="input-group" style="flex: 1; min-width: 150px;">
                        <label>ì…ì‚¬ ì‹œ ê¸‰ì—¬ (ì›)</label>
                        <input type="text" id="historyHireSalary" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;" placeholder="ì…ì‚¬ ì‹œ ê¸‰ì—¬">
                    </div>
                    <button class="btn btn-primary" style="padding: 8px 15px; font-size: 13px;" onclick="saveHireDateFromHistory()">ì €ì¥</button>
                </div>
            </div>

            <!-- ê·¼ë¬´ì¡°ê±´ ë³€ê²½ ì´ë ¥ ì„¹ì…˜ -->
            <div style="font-weight: bold; margin-bottom: 10px; color: #2c3e50;">ğŸ“‹ ê·¼ë¬´ì¡°ê±´ ë³€ê²½ ì´ë ¥</div>
            <div id="historyListContainer" style="max-height: 350px; overflow-y: auto;"></div>
            <div class="btn-group" style="margin-top: 15px;">
                <button class="btn btn-success" onclick="addNewHistory()">+ ì´ë ¥ ì¶”ê°€</button>
            </div>
        </div>
    </div>

    <!-- ê·¼ë¡œê³„ì•½ì„œ ì‘ì„± ëª¨ë‹¬ -->
    <div id="contractModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <span class="modal-close" onclick="closeContractModal()">&times;</span>
            <div class="modal-header">ê·¼ë¡œê³„ì•½ì„œ ì‘ì„±</div>
            <div class="input-group" style="margin-bottom: 15px;">
                <label>ê³„ì•½ ì‹œì‘ì¼</label>
                <input type="date" id="contractStartDate">
            </div>
            <div class="input-group" style="margin-bottom: 15px;">
                <label>ê³„ì•½ ì¢…ë£Œì¼</label>
                <input type="date" id="contractEndDate">
                <label style="margin-top:8px; font-size:13px;">
                    <input type="checkbox" id="noEndDate" onchange="toggleEndDate()"> ì •ê·œì§ (ê¸°ê°„ì˜ ì •í•¨ì´ ì—†ìŒ)
                </label>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="generateContract(); closeContractModal();">ê³„ì•½ì„œ ìƒì„±</button>
            </div>
        </div>
    </div>

    <!-- ì´ë ¥ ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editHistoryModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <span class="modal-close" onclick="closeEditHistoryModal()">&times;</span>
            <div class="modal-header">ì´ë ¥ ìˆ˜ì •</div>
            <input type="hidden" id="editHistoryEmployeeId">
            <input type="hidden" id="editHistoryIndex">
            <div class="input-group" style="margin-bottom: 15px;">
                <label>ì ìš©ì¼</label>
                <input type="date" id="editHistoryDate">
            </div>
            <div class="input-group" style="margin-bottom: 15px;">
                <label>ê³„ì•½ì›”ê¸‰ (ì›)</label>
                <input type="text" id="editHistorySalary" placeholder="ê¸‰ì—¬">
            </div>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <div class="input-group" style="flex: 1;">
                    <label>ì¶œê·¼ì‹œê°„</label>
                    <input type="time" id="editHistoryStartTime" style="padding: 10px;">
                </div>
                <div class="input-group" style="flex: 1;">
                    <label>í‡´ê·¼ì‹œê°„</label>
                    <input type="time" id="editHistoryEndTime" style="padding: 10px;">
                </div>
            </div>
            <div class="input-group" style="margin-bottom: 15px;">
                <label>ì›” íœ´ë¬´ì¼ìˆ˜</label>
                <select id="editHistoryMonthlyOffDays" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    <option value="4">4ì¼ (ì£¼1íšŒ)</option>
                    <option value="5">5ì¼</option>
                    <option value="6">6ì¼</option>
                    <option value="7">7ì¼</option>
                    <option value="8">8ì¼ (ì£¼2íšŒ)</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="saveHistoryEdit()">ì €ì¥</button>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentCalculation = null;
        let employees = JSON.parse(localStorage.getItem('employees')) || [];

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');

            if (tabName === 'employees') {
                renderEmployeeTable();
            }
        }

        function timeToHours(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours + minutes / 60;
        }

        function formatNumber(num) {
            return Math.round(num).toLocaleString('ko-KR');
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return `${date.getFullYear()}.${String(date.getMonth()+1).padStart(2,'0')}.${String(date.getDate()).padStart(2,'0')}`;
        }

        // ê¸‰ì—¬ ì´ë ¥ì˜ oldSalaryë¥¼ ì ìš©ì¼ ê¸°ì¤€ìœ¼ë¡œ ì¬ê³„ì‚°
        function recalculateSalaryHistory(empIndex) {
            if (empIndex < 0 || !employees[empIndex].salaryHistory) return;

            // ì ìš©ì¼ ê¸°ì¤€ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
            employees[empIndex].salaryHistory.sort((a, b) => new Date(a.date) - new Date(b.date));

            // ê° ì´ë ¥ì˜ oldSalaryë¥¼ ì´ì „ ì´ë ¥ì˜ newSalaryë¡œ ì„¤ì •
            for (let i = 0; i < employees[empIndex].salaryHistory.length; i++) {
                if (i === 0) {
                    // ì²« ë²ˆì§¸ ì´ë ¥ (ì…ì‚¬)ì€ oldSalary = 0
                    employees[empIndex].salaryHistory[i].oldSalary = 0;
                } else {
                    // ì´ì „ ì´ë ¥ì˜ newSalaryë¥¼ í˜„ì¬ì˜ oldSalaryë¡œ
                    employees[empIndex].salaryHistory[i].oldSalary = employees[empIndex].salaryHistory[i - 1].newSalary;
                }
            }

            // í˜„ì¬ ê¸‰ì—¬ë¥¼ ë§ˆì§€ë§‰ ì´ë ¥ì˜ newSalaryë¡œ ì—…ë°ì´íŠ¸
            if (employees[empIndex].salaryHistory.length > 0) {
                const lastHistory = employees[empIndex].salaryHistory[employees[empIndex].salaryHistory.length - 1];
                employees[empIndex].contractSalary = lastHistory.newSalary;
                employees[empIndex].data.contractSalary = lastHistory.newSalary;
            }
        }

        function calculate() {
            const name = document.getElementById('name').value;
            const contractSalary = parseFloat(document.getElementById('contractSalary').value.replace(/,/g, '')) || 0;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const breakTime = parseFloat(document.getElementById('breakTime').value);
            const monthlyOffDays = parseFloat(document.getElementById('monthlyOffDays').value);

            const mealAllowance = parseFloat(document.getElementById('mealAllowance').value.replace(/,/g, '')) || 0;
            const vehicleAllowance = parseFloat(document.getElementById('vehicleAllowance').value.replace(/,/g, '')) || 0;
            const childcareAllowance = parseFloat(document.getElementById('childcareAllowance').value.replace(/,/g, '')) || 0;
            const researchAllowance = parseFloat(document.getElementById('researchAllowance').value.replace(/,/g, '')) || 0;

            const dailyMealCost = parseFloat(document.getElementById('dailyMealCost').value.replace(/,/g, '')) || 0;
            const mealsPerDay = parseFloat(document.getElementById('mealsPerDay').value) || 1;
            const minimumWage = parseFloat(document.getElementById('minimumWage').value.replace(/,/g, '')) || 10030;

            const startHours = timeToHours(startTime);
            const endHours = timeToHours(endTime);
            const dailyTotalHours = endHours - startHours - breakTime;

            const dailyOvertimeHours = dailyTotalHours <= 8 ? 0 : dailyTotalHours - 8;
            const dailyRegularHours = dailyTotalHours - dailyOvertimeHours;

            const weeklyWorkDays = 7 - monthlyOffDays / 4;
            const weeklyHolidayDays = weeklyWorkDays <= 5 ? 0 : weeklyWorkDays - 5;
            const weeklyWeekdayDays = weeklyWorkDays - weeklyHolidayDays;

            const weeklyBaseHours = weeklyWeekdayDays * dailyRegularHours;
            const weeklyOvertimeHours = weeklyWeekdayDays * dailyOvertimeHours;
            const weeklyHolidayHours = weeklyHolidayDays * dailyRegularHours;
            const weeklyHolidayOvertimeHours = weeklyHolidayDays * dailyOvertimeHours;

            let weeklyRestHours = 0;
            if (weeklyBaseHours >= 15) {
                const totalWeeklyWork = weeklyBaseHours + weeklyOvertimeHours + weeklyHolidayHours + weeklyHolidayOvertimeHours;
                weeklyRestHours = totalWeeklyWork > 40 ? 8 : totalWeeklyWork / 40 * 8;
            }

            const monthlyFactor = 4.345;

            const monthlyBaseHours = weeklyBaseHours * 1 * monthlyFactor;
            const monthlyOvertimeHours = weeklyOvertimeHours * 1.5 * monthlyFactor;
            const monthlyHolidayHours = weeklyHolidayHours * 1.5 * monthlyFactor;
            const monthlyHolidayOvertimeHours = weeklyHolidayOvertimeHours * 1.5 * monthlyFactor;
            const monthlyWeeklyRestHours = weeklyRestHours * 1 * monthlyFactor;

            const salaryWithoutAllowances = contractSalary - mealAllowance - vehicleAllowance - childcareAllowance - researchAllowance;
            const totalHours = monthlyBaseHours + monthlyOvertimeHours + monthlyHolidayHours + monthlyHolidayOvertimeHours + monthlyWeeklyRestHours;
            const hourlyRate = totalHours > 0 ? salaryWithoutAllowances / totalHours : 0;

            const monthlyBasePay = hourlyRate * monthlyBaseHours;
            const monthlyWeeklyRestPay = hourlyRate * monthlyWeeklyRestHours;
            const monthlyOvertimePay = hourlyRate * monthlyOvertimeHours;
            const monthlyHolidayPay = hourlyRate * monthlyHolidayHours;
            const monthlyHolidayOvertimePay = hourlyRate * monthlyHolidayOvertimeHours;
            const mealExtra = dailyMealCost * mealsPerDay * weeklyWorkDays * monthlyFactor;

            const combinedBaseSalary = monthlyBasePay + monthlyWeeklyRestPay;
            const totalSalary = contractSalary + mealExtra;

            const regularHours = monthlyBaseHours + monthlyWeeklyRestHours;
            const regularWage = monthlyBasePay + monthlyWeeklyRestPay + mealAllowance + vehicleAllowance + childcareAllowance + researchAllowance;
            const hourlyWage = regularHours > 0 ? regularWage / regularHours : 0;

            // ê²°ê³¼ ì €ì¥
            currentCalculation = {
                name,
                contractSalary,
                startTime,
                endTime,
                breakTime,
                monthlyOffDays,
                mealAllowance,
                vehicleAllowance,
                childcareAllowance,
                researchAllowance,
                dailyMealCost,
                mealsPerDay,
                dailyTotalHours,
                weeklyWorkDays,
                monthlyBasePay,
                monthlyWeeklyRestPay,
                monthlyOvertimePay,
                monthlyHolidayPay,
                monthlyHolidayOvertimePay,
                mealExtra,
                combinedBaseSalary,
                totalSalary,
                hourlyWage,
                weeklyOvertimeHours,
                weeklyHolidayHours,
                weeklyHolidayOvertimeHours
            };

            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('resultBaseSalary').textContent = formatNumber(combinedBaseSalary) + 'ì›';
            document.getElementById('resultOvertimePay').textContent = formatNumber(monthlyOvertimePay) + 'ì›';
            document.getElementById('resultHolidayPay').textContent = formatNumber(monthlyHolidayPay) + 'ì›';
            document.getElementById('resultHolidayOvertimePay').textContent = formatNumber(monthlyHolidayOvertimePay) + 'ì›';
            document.getElementById('resultMealExtra').textContent = formatNumber(mealExtra) + 'ì›';
            document.getElementById('resultMeal').textContent = formatNumber(mealAllowance) + 'ì›';
            document.getElementById('resultVehicle').textContent = formatNumber(vehicleAllowance) + 'ì›';
            document.getElementById('resultChildcare').textContent = formatNumber(childcareAllowance) + 'ì›';
            document.getElementById('resultResearch').textContent = formatNumber(researchAllowance) + 'ì›';
            document.getElementById('resultTotal').textContent = formatNumber(totalSalary) + 'ì›';

            const minWageCheck = document.getElementById('minimumWageCheck');
            if (hourlyWage >= minimumWage) {
                minWageCheck.className = 'minimum-wage-check pass';
                minWageCheck.textContent = `ìµœì €ì„ê¸ˆ ê²€ì¦: í†µìƒì‹œê¸‰ ${formatNumber(hourlyWage)}ì› (ìµœì €ì„ê¸ˆ ${formatNumber(minimumWage)}ì› ì´ìƒ - ì í•©)`;
            } else {
                minWageCheck.className = 'minimum-wage-check fail';
                minWageCheck.textContent = `ìµœì €ì„ê¸ˆ ê²€ì¦: í†µìƒì‹œê¸‰ ${formatNumber(hourlyWage)}ì› (ìµœì €ì„ê¸ˆ ${formatNumber(minimumWage)}ì› ë¯¸ë§Œ - ë¶€ì í•©!)`;
            }

            document.getElementById('resultArea').scrollIntoView({ behavior: 'smooth' });
        }

        // ì§ì› ì €ì¥
        function saveEmployee() {
            if (!currentCalculation || !currentCalculation.name) {
                alert('ë¨¼ì € ê¸‰ì—¬ë¥¼ ê³„ì‚°í•´ì£¼ì„¸ìš”.');
                return;
            }

            const existingIndex = employees.findIndex(e => e.name === currentCalculation.name);
            const today = new Date().toISOString().split('T')[0];

            if (existingIndex >= 0) {
                // ê¸°ì¡´ ì§ì› - ê·¼ë¬´ì¡°ê±´ ë³€ê²½ ì´ë ¥ ì¶”ê°€
                const oldSalary = employees[existingIndex].contractSalary;
                const oldData = employees[existingIndex].data || {};
                const hasChanges = oldSalary !== currentCalculation.contractSalary ||
                    oldData.startTime !== currentCalculation.startTime ||
                    oldData.endTime !== currentCalculation.endTime ||
                    oldData.monthlyOffDays !== currentCalculation.monthlyOffDays;

                if (hasChanges) {
                    employees[existingIndex].salaryHistory.push({
                        date: today,
                        oldSalary: oldSalary,
                        newSalary: currentCalculation.contractSalary,
                        startTime: currentCalculation.startTime,
                        endTime: currentCalculation.endTime,
                        monthlyOffDays: currentCalculation.monthlyOffDays
                    });
                }
                employees[existingIndex].contractSalary = currentCalculation.contractSalary;
                employees[existingIndex].data = { ...currentCalculation };
                alert(`${currentCalculation.name}ë‹˜ì˜ ì •ë³´ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            } else {
                // ìƒˆ ì§ì›
                employees.push({
                    id: Date.now(),
                    name: currentCalculation.name,
                    contractSalary: currentCalculation.contractSalary,
                    data: { ...currentCalculation },
                    salaryHistory: [{
                        date: today,
                        oldSalary: 0,
                        newSalary: currentCalculation.contractSalary,
                        startTime: currentCalculation.startTime,
                        endTime: currentCalculation.endTime,
                        monthlyOffDays: currentCalculation.monthlyOffDays
                    }],
                    createdAt: today
                });
                alert(`${currentCalculation.name}ë‹˜ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }

            localStorage.setItem('employees', JSON.stringify(employees));
        }

        // ì§ì› í…Œì´ë¸” ë Œë”ë§
        function renderEmployeeTable() {
            const tbody = document.getElementById('employeeTableBody');

            if (employees.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #999;">ì €ì¥ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            tbody.innerHTML = employees.map(emp => {
                const hireDate = emp.hireDate || emp.createdAt || '-';

                return `<tr>
                    <td><strong>${emp.name}</strong></td>
                    <td>${hireDate !== '-' ? hireDate : '<span style="color:#999">ë¯¸ì„¤ì •</span>'}</td>
                    <td>${formatNumber(emp.contractSalary)}ì›</td>
                    <td>
                        <button class="btn btn-info" style="padding:5px 10px; font-size:12px;" onclick="loadEmployee(${emp.id})">ë¶ˆëŸ¬ì˜¤ê¸°</button>
                        <button class="btn btn-secondary" style="padding:5px 10px; font-size:12px;" onclick="openHistoryModal(${emp.id})">ì´ë ¥ê´€ë¦¬</button>
                        <button class="btn btn-danger" style="padding:5px 10px; font-size:12px;" onclick="deleteEmployee(${emp.id})">ì‚­ì œ</button>
                    </td>
                </tr>`;
            }).join('');
        }

        // ì´ë ¥ ê´€ë¦¬ ëª¨ë‹¬
        function openHistoryModal(id) {
            const emp = employees.find(e => e.id === id);
            if (!emp) return;

            document.getElementById('modalHistoryEmployeeId').value = id;

            // ì…ì‚¬ì¼ ì •ë³´ ì±„ìš°ê¸°
            document.getElementById('historyHireDate').value = emp.hireDate || '';

            // ì²« ë²ˆì§¸ ê¸‰ì—¬ ì´ë ¥ì—ì„œ ì…ì‚¬ ì‹œ ê¸‰ì—¬ ê°€ì ¸ì˜¤ê¸°
            const sortedHistory = [...(emp.salaryHistory || [])].sort((a, b) => new Date(a.date) - new Date(b.date));
            const firstSalary = sortedHistory.length > 0 ? sortedHistory[0].newSalary : emp.contractSalary;
            document.getElementById('historyHireSalary').value = formatNumber(firstSalary);

            renderHistoryList(emp);
            document.getElementById('historyModal').classList.add('active');
        }

        // ì…ì‚¬ì¼ ì €ì¥ (ì´ë ¥ê´€ë¦¬ ëª¨ë‹¬ì—ì„œ)
        function saveHireDateFromHistory() {
            const id = parseInt(document.getElementById('modalHistoryEmployeeId').value);
            const hireDate = document.getElementById('historyHireDate').value;
            const hireSalary = parseFloat(document.getElementById('historyHireSalary').value.replace(/,/g, '')) || 0;

            const empIndex = employees.findIndex(e => e.id === id);
            if (empIndex < 0) return;

            employees[empIndex].hireDate = hireDate;

            // ì…ì‚¬ì¼ ê¸‰ì—¬ ì´ë ¥ ì—…ë°ì´íŠ¸ (ì²« ë²ˆì§¸ ì´ë ¥)
            if (employees[empIndex].salaryHistory && employees[empIndex].salaryHistory.length > 0) {
                employees[empIndex].salaryHistory.sort((a, b) => new Date(a.date) - new Date(b.date));
                employees[empIndex].salaryHistory[0].date = hireDate;
                employees[empIndex].salaryHistory[0].newSalary = hireSalary;
            } else {
                employees[empIndex].salaryHistory = [{
                    date: hireDate,
                    oldSalary: 0,
                    newSalary: hireSalary
                }];
            }

            // ì ìš©ì¼ ê¸°ì¤€ìœ¼ë¡œ oldSalary ì¬ê³„ì‚°
            recalculateSalaryHistory(empIndex);

            localStorage.setItem('employees', JSON.stringify(employees));

            // ì´ë ¥ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            const emp = employees.find(e => e.id === id);
            renderHistoryList(emp);
            renderEmployeeTable();

            alert('ì…ì‚¬ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function closeHistoryModal() {
            document.getElementById('historyModal').classList.remove('active');
        }

        function renderHistoryList(emp) {
            const container = document.getElementById('historyListContainer');
            const sortedHistory = [...(emp.salaryHistory || [])].sort((a, b) => new Date(a.date) - new Date(b.date));

            if (sortedHistory.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#999;">ë“±ë¡ëœ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            let html = `<table class="history-manage-table">
                <thead>
                    <tr>
                        <th style="width:60px;">ìˆœì„œ</th>
                        <th style="width:90px;">ì ìš©ì¼</th>
                        <th style="width:100px;">ê³„ì•½ì›”ê¸‰</th>
                        <th style="width:70px;">ê¸‰ì—¬ë³€ë™</th>
                        <th style="width:100px;">ì¶œí‡´ê·¼ì‹œê°„</th>
                        <th style="width:60px;">ì›”íœ´ë¬´</th>
                        <th style="width:80px;">ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody>`;

            sortedHistory.forEach((h, idx) => {
                const diff = h.newSalary - h.oldSalary;
                const badge = diff > 0 ? 'badge-up' : (diff < 0 ? 'badge-down' : '');
                const sign = diff > 0 ? '+' : '';
                const isFirst = idx === 0;
                const startTime = h.startTime || '-';
                const endTime = h.endTime || '-';
                const monthlyOffDays = h.monthlyOffDays || '-';

                html += `<tr>
                    <td>${idx + 1}${isFirst ? '<br><small>(ì…ì‚¬)</small>' : ''}</td>
                    <td>${h.date}</td>
                    <td style="text-align:right;">${formatNumber(h.newSalary)}ì›</td>
                    <td>${diff !== 0 ? `<span class="badge ${badge}">${sign}${formatNumber(diff)}</span>` : '-'}</td>
                    <td>${startTime !== '-' ? `${startTime}~${endTime}` : '-'}</td>
                    <td>${monthlyOffDays !== '-' ? `${monthlyOffDays}ì¼` : '-'}</td>
                    <td>
                        <button class="btn btn-info" onclick="openEditHistoryModal(${emp.id}, ${idx})">ìˆ˜ì •</button>
                        ${!isFirst ? `<button class="btn btn-danger" onclick="deleteHistory(${emp.id}, ${idx})">ì‚­ì œ</button>` : ''}
                    </td>
                </tr>`;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // ì´ë ¥ ìˆ˜ì • ëª¨ë‹¬
        function openEditHistoryModal(empId, historyIdx) {
            const emp = employees.find(e => e.id === empId);
            if (!emp) return;

            const sortedHistory = [...(emp.salaryHistory || [])].sort((a, b) => new Date(a.date) - new Date(b.date));
            const history = sortedHistory[historyIdx];
            if (!history) return;

            document.getElementById('editHistoryEmployeeId').value = empId;
            document.getElementById('editHistoryIndex').value = historyIdx;
            document.getElementById('editHistoryDate').value = history.date;
            document.getElementById('editHistorySalary').value = formatNumber(history.newSalary);
            document.getElementById('editHistoryStartTime').value = history.startTime || emp.data?.startTime || '08:00';
            document.getElementById('editHistoryEndTime').value = history.endTime || emp.data?.endTime || '17:00';
            document.getElementById('editHistoryMonthlyOffDays').value = history.monthlyOffDays || emp.data?.monthlyOffDays || '8';

            document.getElementById('editHistoryModal').classList.add('active');
        }

        function closeEditHistoryModal() {
            document.getElementById('editHistoryModal').classList.remove('active');
        }

        function saveHistoryEdit() {
            const empId = parseInt(document.getElementById('editHistoryEmployeeId').value);
            const historyIdx = parseInt(document.getElementById('editHistoryIndex').value);
            const newDate = document.getElementById('editHistoryDate').value;
            const newSalary = parseFloat(document.getElementById('editHistorySalary').value.replace(/,/g, '')) || 0;
            const newStartTime = document.getElementById('editHistoryStartTime').value;
            const newEndTime = document.getElementById('editHistoryEndTime').value;
            const newMonthlyOffDays = parseInt(document.getElementById('editHistoryMonthlyOffDays').value);

            const empIndex = employees.findIndex(e => e.id === empId);
            if (empIndex < 0) return;

            // ë‚ ì§œìˆœ ì •ë ¬
            employees[empIndex].salaryHistory.sort((a, b) => new Date(a.date) - new Date(b.date));

            // í•´ë‹¹ ì´ë ¥ ìˆ˜ì •
            const history = employees[empIndex].salaryHistory[historyIdx];
            if (history) {
                history.date = newDate;
                history.newSalary = newSalary;
                history.startTime = newStartTime;
                history.endTime = newEndTime;
                history.monthlyOffDays = newMonthlyOffDays;
            }

            // ì ìš©ì¼ ê¸°ì¤€ìœ¼ë¡œ oldSalary ì¬ê³„ì‚°
            recalculateSalaryHistory(empIndex);

            // ë§ˆì§€ë§‰ ì´ë ¥ì´ë©´ í˜„ì¬ ê·¼ë¬´ì¡°ê±´ë„ ì—…ë°ì´íŠ¸
            const sortedHistory = employees[empIndex].salaryHistory.sort((a, b) => new Date(a.date) - new Date(b.date));
            if (historyIdx === sortedHistory.length - 1) {
                employees[empIndex].data.startTime = newStartTime;
                employees[empIndex].data.endTime = newEndTime;
                employees[empIndex].data.monthlyOffDays = newMonthlyOffDays;
            }

            localStorage.setItem('employees', JSON.stringify(employees));
            closeEditHistoryModal();

            // ì´ë ¥ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            const emp = employees.find(e => e.id === empId);
            renderHistoryList(emp);
            renderEmployeeTable();

            alert('ì´ë ¥ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ì´ë ¥ ì‚­ì œ
        function deleteHistory(empId, historyIdx) {
            if (!confirm('ì´ ì´ë ¥ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            const empIndex = employees.findIndex(e => e.id === empId);
            if (empIndex < 0) return;

            // ë‚ ì§œìˆœ ì •ë ¬
            employees[empIndex].salaryHistory.sort((a, b) => new Date(a.date) - new Date(b.date));

            // ì´ë ¥ ì‚­ì œ
            employees[empIndex].salaryHistory.splice(historyIdx, 1);

            // ì ìš©ì¼ ê¸°ì¤€ìœ¼ë¡œ oldSalary ì¬ê³„ì‚°
            recalculateSalaryHistory(empIndex);

            localStorage.setItem('employees', JSON.stringify(employees));

            // ì´ë ¥ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            const emp = employees.find(e => e.id === empId);
            renderHistoryList(emp);
            renderEmployeeTable();

            alert('ì´ë ¥ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ìƒˆ ì´ë ¥ ì¶”ê°€
        function addNewHistory() {
            const empId = parseInt(document.getElementById('modalHistoryEmployeeId').value);
            openSalaryModal(empId);
            closeHistoryModal();
        }

        // ì§ì› ë¶ˆëŸ¬ì˜¤ê¸°
        function loadEmployee(id) {
            const emp = employees.find(e => e.id === id);
            if (!emp) return;

            document.getElementById('name').value = emp.data.name;
            document.getElementById('contractSalary').value = emp.data.contractSalary;
            document.getElementById('startTime').value = emp.data.startTime;
            document.getElementById('endTime').value = emp.data.endTime;
            document.getElementById('breakTime').value = emp.data.breakTime;
            document.getElementById('monthlyOffDays').value = emp.data.monthlyOffDays;
            document.getElementById('mealAllowance').value = emp.data.mealAllowance;
            document.getElementById('vehicleAllowance').value = emp.data.vehicleAllowance;
            document.getElementById('childcareAllowance').value = emp.data.childcareAllowance;
            document.getElementById('researchAllowance').value = emp.data.researchAllowance;
            document.getElementById('dailyMealCost').value = emp.data.dailyMealCost || 8000;
            document.getElementById('mealsPerDay').value = emp.data.mealsPerDay || 1;

            showTab('calculator');

            // ì²œìë¦¬ êµ¬ë¶„ ê¸°í˜¸ ì ìš©
            numericInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input && input.value) formatInputNumber(input);
            });

            calculate();
        }

        // ì§ì› ì‚­ì œ
        function deleteEmployee(id) {
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            employees = employees.filter(e => e.id !== id);
            localStorage.setItem('employees', JSON.stringify(employees));
            renderEmployeeTable();
        }

        // ê·¼ë¬´ì¡°ê±´ ë³€ê²½ ëª¨ë‹¬
        function openSalaryModal(id) {
            const emp = employees.find(e => e.id === id);
            if (!emp) return;

            document.getElementById('modalEmployeeId').value = id;
            document.getElementById('modalNewSalary').value = formatNumber(emp.contractSalary);
            document.getElementById('modalChangeDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('modalStartTime').value = emp.data?.startTime || '08:00';
            document.getElementById('modalEndTime').value = emp.data?.endTime || '17:00';
            document.getElementById('modalMonthlyOffDays').value = emp.data?.monthlyOffDays || '8';
            document.getElementById('salaryModal').classList.add('active');
        }

        function closeSalaryModal() {
            document.getElementById('salaryModal').classList.remove('active');
        }

        function updateEmployeeSalary() {
            const id = parseInt(document.getElementById('modalEmployeeId').value);
            const newSalary = parseFloat(document.getElementById('modalNewSalary').value.replace(/,/g, '')) || 0;
            const changeDate = document.getElementById('modalChangeDate').value;
            const newStartTime = document.getElementById('modalStartTime').value;
            const newEndTime = document.getElementById('modalEndTime').value;
            const newMonthlyOffDays = parseInt(document.getElementById('modalMonthlyOffDays').value);

            const empIndex = employees.findIndex(e => e.id === id);
            if (empIndex < 0) return;

            // ìƒˆ ì´ë ¥ ì¶”ê°€ (oldSalaryëŠ” ì„ì‹œê°’, recalculateì—ì„œ ì¬ê³„ì‚°ë¨)
            employees[empIndex].salaryHistory.push({
                date: changeDate,
                oldSalary: 0,
                newSalary: newSalary,
                startTime: newStartTime,
                endTime: newEndTime,
                monthlyOffDays: newMonthlyOffDays
            });

            // ì ìš©ì¼ ê¸°ì¤€ìœ¼ë¡œ oldSalary ì¬ê³„ì‚°
            recalculateSalaryHistory(empIndex);

            // í˜„ì¬ ê·¼ë¬´ì¡°ê±´ ì—…ë°ì´íŠ¸
            employees[empIndex].data.startTime = newStartTime;
            employees[empIndex].data.endTime = newEndTime;
            employees[empIndex].data.monthlyOffDays = newMonthlyOffDays;

            localStorage.setItem('employees', JSON.stringify(employees));
            closeSalaryModal();
            renderEmployeeTable();
            alert('ê·¼ë¬´ì¡°ê±´ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸°
        function exportEmployeeData() {
            const dataStr = JSON.stringify(employees, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ì§ì›ë°ì´í„°_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        function importEmployeeData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (confirm(`${imported.length}ëª…ì˜ ì§ì› ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ? ê¸°ì¡´ ë°ì´í„°ëŠ” ìœ ì§€ë©ë‹ˆë‹¤.`)) {
                        imported.forEach(imp => {
                            if (!employees.find(e => e.name === imp.name)) {
                                employees.push(imp);
                            }
                        });
                        localStorage.setItem('employees', JSON.stringify(employees));
                        renderEmployeeTable();
                        alert('ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.');
                    }
                } catch (err) {
                    alert('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // ê·¼ë¡œê³„ì•½ì„œ ëª¨ë‹¬
        function showContractModal() {
            if (!currentCalculation) {
                alert('ë¨¼ì € ê¸‰ì—¬ ê³„ì‚°ì„ í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ê°’ ì„¤ì •
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('contractStartDate').value = today;

            document.getElementById('contractModal').classList.add('active');
        }

        function closeContractModal() {
            document.getElementById('contractModal').classList.remove('active');
        }

        // ê·¼ë¡œê³„ì•½ì„œ ìƒì„±
        function generateContract() {
            if (!currentCalculation) {
                alert('ë¨¼ì € ê¸‰ì—¬ ê³„ì‚°ì„ í•´ì£¼ì„¸ìš”.');
                return;
            }

            const name = currentCalculation.name || '';
            const startDate = document.getElementById('contractStartDate').value || '';
            const endDate = document.getElementById('contractEndDate').value || '';

            const calc = currentCalculation;
            const contractSalary = calc.contractSalary || 0;
            const startTime = calc.startTime || '09:00';
            const endTime = calc.endTime || '18:00';
            const breakTimeVal = calc.breakTime || 1;
            const breakTimeStr = breakTimeVal === 1 ? '1ì‹œê°„' : breakTimeVal === 0.5 ? '30ë¶„' : breakTimeVal === 1.5 ? '1ì‹œê°„ 30ë¶„' : '2ì‹œê°„';
            const dailyHours = calc.dailyTotalHours || 8;
            const monthlyOffDays = calc.monthlyOffDays || 8;

            // íœ´ë¬´ì¼ìˆ˜ì— ë”°ë¥¸ êµ¬ë¶„ í‘œì‹œ (ì›” 8ì¼ íœ´ë¬´ = ì£¼ 5ì¼ ê·¼ë¬´)
            const workTypeLabel = monthlyOffDays == 8 ? 'ì£¼ 5ì¼ ê·¼ë¬´' : `ì›” ${monthlyOffDays}ì¼ íœ´ë¬´`;

            // ì‹œê°„ì™¸ê·¼ë¡œ ì‹œê°„ ê³„ì‚°
            const overtimeHours = Math.ceil((calc.weeklyOvertimeHours || 0) * 4.345 * 100) / 100;
            const holidayHours = Math.ceil((calc.weeklyHolidayHours || 0) * 4.345 * 100) / 100;
            const holidayOvertimeHours = Math.ceil((calc.weeklyHolidayOvertimeHours || 0) * 4.345 * 100) / 100;

            const previewHtml = `
            <div class="contract-preview" id="contractPrint">
                <h2>ê·¼ ë¡œ ê³„ ì•½ ì„œ</h2>

                <table class="contract-table">
                    <colgroup>
                        <col style="width:12%;">
                        <col style="width:14%;">
                        <col style="width:30%;">
                        <col style="width:14%;">
                        <col style="width:30%;">
                    </colgroup>
                    <tr>
                        <th rowspan="3">"ê°‘"<br>(ì‚¬ìš©ì)</th>
                        <th>ì‚¬ì—…ì¥ ëª…ì¹­</th>
                        <td>ë†ì—…íšŒì‚¬ë²•ì¸ãˆœìœ¡êµ¬ì´</td>
                        <th>ì „í™”</th>
                        <td>031-444-8882</td>
                    </tr>
                    <tr>
                        <th>ì†Œì¬ì§€</th>
                        <td colspan="3">ê²½ê¸°ë„ ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬ ë°•ë‹¬ë¡œ 298, í˜‘ì‹ ì‹í’ˆ ë‚˜ë™ ì§€í•˜1ì¸µ</td>
                    </tr>
                    <tr>
                        <th>ëŒ€í‘œ</th>
                        <td>ê¹€ìš°í˜•, ê¹€ë¯¼ì„œ</td>
                        <th>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</th>
                        <td>495-86-02705</td>
                    </tr>
                </table>

                <table class="contract-table" style="margin-top:-1px;">
                    <colgroup>
                        <col style="width:12%;">
                        <col style="width:14%;">
                        <col style="width:30%;">
                        <col style="width:14%;">
                        <col style="width:30%;">
                    </colgroup>
                    <tr>
                        <th rowspan="3">"ì„"<br>(ê·¼ë¡œì)</th>
                        <th>ì„±ëª…</th>
                        <td>${name}</td>
                        <th>ì „í™”ë²ˆí˜¸</th>
                        <td style="min-height: 20px;"></td>
                    </tr>
                    <tr>
                        <th>ìƒë…„ì›”ì¼</th>
                        <td colspan="3" style="min-height: 20px;"></td>
                    </tr>
                    <tr>
                        <th>ì£¼ì†Œ</th>
                        <td colspan="3" style="min-height: 20px;"></td>
                    </tr>
                </table>

                <p><strong>1. ê·¼ë¡œê³„ì•½ê¸°ê°„:</strong> ${formatDate(startDate)} ë¶€í„° ${endDate ? formatDate(endDate) + ' ê¹Œì§€' : '<u>ê¸°ê°„ì˜ ì •í•¨ì´ ì—†ìŒ</u>'}</p>
                <p><strong>2. ê·¼ë¬´ì¥ì†Œ:</strong> ê·¼ë¬´ì¥ì†ŒëŠ” ê°‘ì˜ ì‚¬ì—…ì¥ ë° ì‚¬ì—…ê³¼ ê´€ë ¨ëœ ì¥ì†Œë¡œ í•œë‹¤. ë‹¤ë§Œ, ì—…ë¬´ì˜ í•„ìš”ë‚˜ ë¶€ë“ì´í•œ ì‚¬ì •ì´ ìˆëŠ” ê²½ìš° ê·¼ë¬´ì¥ì†Œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.</p>
                <p><strong>3. ì—…ë¬´ë‚´ìš©:</strong> ê°‘ ì‚¬ì—…ì¥ì˜ ì´ìµê³¼ ê´€ë ¨ëœ ì¼ì²´ ì—…ë¬´</p>

                <p><strong>4. ê·¼ë¡œì‹œê°„ ë° íœ´ê²Œì‹œê°„</strong></p>
                <table class="contract-table">
                    <tr>
                        <th style="width:90px;">êµ¬ë¶„</th>
                        <th>ê·¼ë¡œì‹œê°„</th>
                        <th>íœ´ê²Œì‹œê°„</th>
                        <th style="width:70px;">ì¼ì‹¤ê·¼ë¡œì‹œê°„</th>
                    </tr>
                    <tr>
                        <td>${workTypeLabel}</td>
                        <td>${startTime} ~ ${endTime}</td>
                        <td>${breakTimeStr}ì˜ ììœ ë¡œìš´ íœ´ê²Œì‹œê°„ ë¶€ì—¬</td>
                        <td>${dailyHours}ì‹œê°„</td>
                    </tr>
                </table>
                <p class="indent">íšŒì‚¬ ì—…ë¬´ì˜ í•„ìš”ì— ë”°ë¼ "ì„"ì˜ ê·¼ë¡œì‹œê°„ ë° íœ´ê²Œì‹œê°„ì„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.</p>

                <p><strong>5. ì‹œê°„ì™¸ê·¼ë¡œ(ì—°ì¥ê·¼ë¡œ, ì•¼ê°„ê·¼ë¡œ, íœ´ì¼ê·¼ë¡œ)</strong></p>
                <p class="indent">(1) "ì„"ì˜ ì—…ë¬´íŠ¹ì„±ìƒ ì‹œê°„ì™¸ê·¼ë¡œê°€ í†µìƒì ìœ¼ë¡œ ë°œìƒí•˜ë¯€ë¡œ "ê°‘"ì€ "ì„"ì—ê²Œ ì†Œì •ê·¼ë¡œì‹œê°„ì™¸ì— ë§¤ì›” ${overtimeHours}ì‹œê°„ì˜ ì—°ì¥ê·¼ë¡œ, ${holidayHours}ì‹œê°„ì˜ íœ´ì¼ê·¼ë¡œ, ${holidayOvertimeHours}ì‹œê°„ì˜ íœ´ì¼ì—°ì¥ê·¼ë¡œì— ëŒ€í•œ ë™ì˜ë¥¼ êµ¬í•˜ë©°, "ê°‘"ì€ "ì„"ì—ê²Œ ì‹œê°„ì™¸ê·¼ë¡œìˆ˜ë‹¹ì„ ì—°ë´‰ì‚°ì •ì‹œ í¬ê´„í•˜ì—¬ ë§¤ì›” ì§€ê¸‰í•˜ê¸°ë¡œ í•œë‹¤.</p>
                <p class="indent">(2) "ê°‘"ì˜ ëª…ì‹œì ì¸ ìš”êµ¬ë‚˜ ì§€ì‹œì— ì˜í•˜ì§€ ì•„ë‹ˆí•œ ì„ì˜ ì‹œê°„ì™¸ ê·¼ë¡œëŠ” ì´ë¥¼ ê·¼ë¡œí•œ ê²ƒìœ¼ë¡œ ë³´ì§€ ì•„ë‹ˆí•œë‹¤.</p>

                <p><strong>6. ê·¼ë¬´ì¼ / íœ´ì¼</strong></p>
                ${monthlyOffDays != 8 ? `<p class="indent">(1) ì›” ${monthlyOffDays}íšŒ íœ´ë¬´ë¥¼ ê¸°ë³¸ìœ¼ë¡œ í•œë‹¤.</p>` : ''}
                <p class="indent">${monthlyOffDays != 8 ? '(2)' : '(1)'} ë§¤ì£¼ ì¼ìš”ì¼ì€ ì£¼íœ´ì¼ë¡œ í•˜ë©°, ê·¼ë¡œìì˜ ë‚ ê³¼ ì£¼íœ´ì¼ì€ ìœ ê¸‰íœ´ì¼ë¡œ í•œë‹¤.</p>
                <p class="indent">${monthlyOffDays != 8 ? '(3)' : '(2)'} ìœ„ì˜ ìœ ê¸‰íœ´ì¼ì— ëŒ€í•˜ì—¬ëŠ” ìƒí˜¸í•©ì˜í•˜ì—¬ ëŒ€ì²´í•  ìˆ˜ ìˆë‹¤. ë‹¤ë§Œ, íœ´ì¼ëŒ€ì²´ì˜ ê²½ìš°ì—ëŠ” ìµœì†Œí•œ ëŒ€ì²´ì¼ ì „ì¼ê¹Œì§€ íœ´ì¼ì„ íŠ¹ì •í•˜ì—¬ í†µë³´í•˜ì—¬ì•¼ í•œë‹¤.</p>
                <p class="indent">${monthlyOffDays != 8 ? '(4)' : '(3)'} ê·¼ë¡œì¼ê³¼ íœ´ì¼ì€ ì—…ë¬´ìƒ í•„ìš”ì— ë”°ë¼ ë³€ê²½í•˜ì—¬ ìš´ì˜í•  ìˆ˜ ìˆë‹¤.</p>

                <p><strong>7. ì„ê¸ˆ</strong></p>
                <p class="indent">(1) ì„ê¸ˆì˜ êµ¬ì„±í•­ëª©</p>
                <p class="indent"><strong>ì›”ê¸‰ì€ ${formatNumber(contractSalary)}ì›</strong>ìœ¼ë¡œ í•˜ë©° ë§¤ì›” ì˜ˆê¸ˆí†µì¥ìœ¼ë¡œ ì…ê¸ˆ</p>

                <table class="contract-table">
                    <tr>
                        <th colspan="2">í•­ëª©</th>
                        <th style="width:100px;">ì›” ê¸ˆì•¡</th>
                    </tr>
                    <tr>
                        <td rowspan="2" style="width:80px;">ê¸°ë³¸ê¸‰</td>
                        <td>ê¸°ë³¸ê¸‰</td>
                        <td style="text-align:right;">${formatNumber(calc.monthlyBasePay || 0)}ì›</td>
                    </tr>
                    <tr>
                        <td>ì£¼íœ´ìˆ˜ë‹¹</td>
                        <td style="text-align:right;">${formatNumber(calc.monthlyWeeklyRestPay || 0)}ì›</td>
                    </tr>
                    <tr>
                        <td rowspan="3">ì œìˆ˜ë‹¹<br>(ê°€ì‚°í¬í•¨)</td>
                        <td>ì—°ì¥ê·¼ë¡œìˆ˜ë‹¹</td>
                        <td style="text-align:right;">${formatNumber(calc.monthlyOvertimePay || 0)}ì›</td>
                    </tr>
                    <tr>
                        <td>íœ´ì¼ê·¼ë¡œìˆ˜ë‹¹</td>
                        <td style="text-align:right;">${formatNumber(calc.monthlyHolidayPay || 0)}ì›</td>
                    </tr>
                    <tr>
                        <td>íœ´ì¼ì—°ì¥ìˆ˜ë‹¹</td>
                        <td style="text-align:right;">${formatNumber(calc.monthlyHolidayOvertimePay || 0)}ì›</td>
                    </tr>
                    <tr>
                        <td colspan="2">ì‹ëŒ€</td>
                        <td style="text-align:right;">${formatNumber(calc.mealAllowance || 0)}ì›</td>
                    </tr>
                    <tr>
                        <td colspan="2">ì°¨ëŸ‰ìœ ì§€ë¹„</td>
                        <td style="text-align:right;">${formatNumber(calc.vehicleAllowance || 0)}ì›</td>
                    </tr>
                    <tr>
                        <td colspan="2">ìœ¡ì•„ìˆ˜ë‹¹</td>
                        <td style="text-align:right;">${formatNumber(calc.childcareAllowance || 0)}ì›</td>
                    </tr>
                    <tr>
                        <td colspan="2">ì—°êµ¬ìˆ˜ë‹¹</td>
                        <td style="text-align:right;">${formatNumber(calc.researchAllowance || 0)}ì›</td>
                    </tr>
                </table>

                <p class="indent">(2) ê³„ì‚°ë°©ë²•: í†µìƒì‹œê¸‰ X ê·¼ë¡œì‹œê°„ (ì—°ì¥Â·ì•¼ê°„Â·íœ´ì¼ ê·¼ë¡œì— ëŒ€í•˜ì—¬ëŠ” ê´€ë¦¬ ê³„ì‚°í¸ì˜ ë“±ì„ ìœ„í•´ ì›”í‰ê·  ê³ ì •ê·¼ë¡œì‹œê°„ì„ ì¶”ì‚°í•˜ì—¬ ê°€ì‚°ì„ê¸ˆì„ í¬í•¨í•œ í¬ê´„ì„ê¸ˆìœ¼ë¡œ ì‚°ì •í•˜ë©°, ì‹¤ê·¼ë¡œì‹œê°„ì´ ì´ë¥¼ ì´ˆê³¼í•˜ëŠ” ê²½ìš°ì—ëŠ” ì´ë¥¼ ì •ì‚° ì§€ê¸‰í•œë‹¤. 1ì£¼ë‹¹ ìµœëŒ€ ì£¼íœ´ìˆ˜ë‹¹ì€ ê´€ë ¨ ë²•ì— ì˜ê±°í•˜ì—¬ 8ì‹œê°„ìœ¼ë¡œ í•œë‹¤)</p>
                <p class="indent">(3) ì§€ê¸‰ë°©ë²• ë° ì§€ê¸‰ê¸°ì¼: ë‹¹ì›” 1ì¼~ë‹¹ì›” ë§ì¼ê¹Œì§€ë¥¼ ì •ì‚°í•˜ì—¬ ìµì›” 10ì¼ ì§€ê¸‰, ì§€ê¸‰ì¼ì´ íœ´ì¼ì¸ ê²½ìš° ì „ë‚ ì— ì§€ê¸‰, ì§€ê¸‰ë°©ë²•: ê³„ì¢Œì´ì²´</p>
                <p class="indent">(4) ê¸‰ì—¬ì˜ ê³µì œ</p>
                <p class="indent2">â‘  ê²°ê·¼Â·ì§€ê°Â·ì¡°í‡´Â·ì™¸ì¶œì˜ ê²½ìš° í•´ë‹¹ ì‹œê°„ë¶„ ë§Œí¼ ê³µì œí•˜ê³  ì§€ê¸‰í•œë‹¤.</p>
                <p class="indent2">â‘¡ ê²°ê·¼ì¼ì˜ ì„ê¸ˆê³¼ ê²°ê·¼ì¼ì´ ì†í•˜ëŠ” ì£¼ì˜ ì£¼íœ´ìˆ˜ë‹¹ì„ ê¸‰ì—¬ì—ì„œ ê³µì œí•œë‹¤.</p>
                <p class="indent2">â‘¢ ì£¼ë¯¼ì„¸, ê°‘ê·¼ì„¸, 4ëŒ€ë³´í—˜ë£Œ ì¤‘ ê·¼ë¡œìë¶€ë‹´ë¶„ì€ ê³µì œ í›„ ì§€ê¸‰í•œë‹¤.</p>
                <p class="indent">(5) ì¤‘ë„ ì…ì‚¬, í‡´ì‚¬ìì˜ ê¸‰ì—¬: ì¤‘ë„ì…ì‚¬ì í‡´ì‚¬ìì˜ ê²½ìš° ê¸‰ì—¬ëŠ” ì¼í• í•˜ì—¬ ì§€ê¸‰í•œë‹¤.</p>

                <p><strong>8. ì—°ì°¨ìœ ê¸‰íœ´ê°€</strong></p>
                <p class="indent">(1) ì—°ì°¨ìœ ê¸‰íœ´ê°€ ë“±ì€ ê·¼ë¡œê¸°ì¤€ë²•ì—ì„œ ì •í•˜ëŠ” ë°”ì— ë”°ë¥¸ë‹¤.</p>

                <p><strong>9. ê¸°íƒ€</strong></p>
                <p class="indent">ì´ ê³„ì•½ì—ì„œ ì •í•¨ì´ ì—†ëŠ” ì‚¬í•­ì€ ì·¨ì—…ê·œì¹™ ë° ê·¼ë¡œê¸°ì¤€ë²•ì— ì˜í•œë‹¤.</p>

                <p><strong>10. ì¸ìˆ˜ì¸ê³„ ë° ì¤€ìˆ˜ì‚¬í•­</strong></p>
                <p class="indent">(1) ì„ì€ ê°‘ì´ ì •í•œ ì§€ì‹œì‚¬í•­ ë“±ì„ ì¤€ìˆ˜í•˜ì—¬ì•¼ í•˜ë©°, ì´ë¥¼ ìœ„ë°˜í•œ ê²½ìš° ì´ ê³„ì•½ì„ ì¤‘ë„ì— í•´ì§€í•  ìˆ˜ ìˆë‹¤.</p>
                <p class="indent">(2) ì„ì´ ê³„ì•½ê¸°ê°„ ì¤‘ ê³„ì•½ì„ í•´ì§€í•˜ê³ ì í•˜ëŠ” ê²½ìš° 30ì¼ ì „ì— ì‚¬ì§ì„œë¥¼ ì œì¶œí•˜ì—¬ì•¼ í•˜ë©°, ê°‘ì˜ ìŠ¹ë‚™ì„ ì–»ì–´ì•¼ í•œë‹¤. ë˜í•œ í›„ì„ìë¥¼ ì„ ì„í•˜ì—¬ ì—…ë¬´ ì¸ìˆ˜ì¸ê³„ì‹œê¹Œì§€ ì„±ì‹¤í•˜ê²Œ ê·¼ë¬´í•˜ì—¬ì•¼ í•œë‹¤. ë§Œì•½ ì´ë¥¼ ìœ„ë°˜í•˜ëŠ” ê²½ìš° ë¬´ë‹¨ê²°ê·¼ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.</p>
                <p class="indent">(3) ê·¼ë¡œìëŠ” ì—…ë¬´ ìˆ˜í–‰ìƒ ì°©ì˜¤, ê³¼ì˜¤ ë“±ì´ ë°œìƒí•˜ëŠ” ê²½ìš° ì¦‰ì‹œ ìƒì‚¬ì—ê²Œ ë³´ê³ í•˜ì—¬ì•¼ í•˜ë©°, ê·¸ì˜ ì§€ì‹œë¥¼ ë°›ì•„ í•„ìš”í•œ ì¡°ì¹˜ë¥¼ í•œë‹¤.</p>
                <p class="indent">(4) ê·¼ë¡œìëŠ” ê³„ì•½ê¸°ê°„ ì¤‘ ì—…ë¬´ì™€ ê´€ë ¨í•˜ì—¬ ì•Œê²Œ ëœ ì‚¬ì—…ì£¼ì˜ ì—…ë¬´ìƒ ë¹„ë°€, ê·¼ë¡œê³„ì•½ì˜ ë‚´ìš©, ê¸°íƒ€ ê¸°ë°€ì„ ê³„ì•½ê¸°ê°„ ì¤‘ì€ ë¬¼ë¡ ì´ê³  ê³„ì•½ì¢…ë£Œ í›„ì—ë„ ì œ3ìì—ê²Œ ëˆ„ì„¤í•˜ê±°ë‚˜ ë³¸ ê³„ì•½ì˜ ì´í–‰ ì´ì™¸ì˜ ëª©ì ìœ¼ë¡œ ì´ìš©í•˜ì—¬ì„œëŠ” ì•„ë‹ˆë˜ë©°, ìœ„ë°˜í•˜ëŠ” ê²½ìš° ë¯¼í˜•ì‚¬ì±…ì„ì„ ì§„ë‹¤.</p>
                <p class="indent">(5) ê·¼ë¡œìëŠ” ë³¸ì¸ ë° íƒ€ì¸ì˜ ê°œì¸ì •ë³´ ë˜ëŠ” ê¸‰ì—¬ ë“±ì„ ë°œì„¤í•˜ì§€ ì•Šìœ¼ë©°, ì´ë¥¼ ìœ„ë°˜í•˜ì—¬ ê·¼ë¡œìë“¤ ê°„ ìœ„í•´ë¥¼ ì¡°ì„±í•˜ë©´ ê°ë´‰ ë° ì§•ê³„ ë“± ë¶ˆì´ìµì´ ìˆì„ ìˆ˜ ìˆë‹¤.</p>

                <p><strong>11. ê·¼ë¡œê³„ì•½ í•´ì§€ì‚¬ìœ </strong></p>
                <p class="indent">ê°‘ì€ ë‹¤ìŒ ê° í˜¸ì˜ ì‚¬ìœ ê°€ ìˆì„ ë•Œì—ëŠ” ì„ê³¼ì˜ ê·¼ë¡œê³„ì•½ì„ í•´ì§€í•  ìˆ˜ ìˆë‹¤.</p>
                <p class="indent">(1) ë°˜ë³µì ì¸ ì§€ê°(ì›” 5íšŒ ì´ìƒ)ìœ¼ë¡œ ì¸í•´ ê·¼ë¡œì œê³µì— ì§€ì¥ì„ ì´ˆë˜í•˜ëŠ” ê²½ìš°</p>
                <p class="indent">(2) ì •ë‹¹í•œ ì‚¬ìœ  ì—†ì´ ë¬´ë‹¨ìœ¼ë¡œ ì¡°í‡´ ë˜ëŠ” ì™¸ì¶œ, ê²°ê·¼(ì›” 3ì¼ ì´ìƒ)ì„ ì§€ì†ì ìœ¼ë¡œ ë°˜ë³µí•˜ëŠ” ê²½ìš°</p>
                <p class="indent">(3) ì •ë‹¹í•œ ì´ìœ  ì—†ì´ ì—…ë¬´ìˆ˜í–‰ì„ ì§€ì²´í•˜ê±°ë‚˜ ë¶ˆì„±ì‹¤í•˜ë‹¤ê³  ì¸ì •ë˜ëŠ” ê²½ìš°</p>
                <p class="indent">(4) ê·¼ë¡œìë“¤ ê°„ ìœ„í•´ë¥¼ ì¡°ì„±í•˜ì—¬ ê·¼ë¬´ë¶„ìœ„ê¸°ë¥¼ í•´ì¹˜ëŠ” ë“± ì‚¬ì—…ì¥ì— ì†í•´ë¥¼ ë¼ì¹˜ëŠ” ê²½ìš°</p>
                <p class="indent">(5) ê¸°íƒ€ ë²•ë ¹ ë° ì‚¬íšŒìƒê·œë¥¼ ìœ„ë°˜í•˜ì—¬ ì‚¬íšŒí†µë…ìƒ ê³„ì†ì ìœ¼ë¡œ ê·¼ë¡œê´€ê³„ë¥¼ ìœ ì§€í•˜ê¸° ì–´ë ¤ìš´ ê²½ìš°</p>
                <p class="indent">(6) ê·¼ë¡œìì˜ ì •ì‹ , ì‹ ì²´ìƒì˜ ì‚¬ìœ ë¡œ ê³„ì† ì—…ë¬´ìˆ˜í–‰ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤ê³  ì¸ì •ë˜ëŠ” ê²½ìš°</p>
                <p class="indent">(7) ê·¼ë¡œìê°€ í­í–‰, íŒŒê´´, íƒœì—…ì„ ì„ ë™í•˜ëŠ” ë“± ë¶ˆë¯¸í•œ í–‰ìœ„ë¥¼ í•˜ëŠ” ê²½ìš°</p>
                <p class="indent">(8) ì‚¬ì—…ì£¼ì˜ ë™ì˜ ì—†ì´ íƒ€ ì‚¬ì—…ì¥ì— ì·¨ì—…í•˜ê±°ë‚˜, ê´€ë¦¬ê°ë… ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ ë¬´ë‹¨ì´íƒˆí•œ ê²½ìš°</p>

                <div class="signature-section" style="margin-top:20px; text-align:center;">
                    <p>${new Date().getFullYear()}ë…„ ${new Date().getMonth()+1}ì›” ${new Date().getDate()}ì¼</p>
                </div>

                <div style="margin-top:15px; position: relative;">
                    <p><strong>(ê°‘) ì‚¬ì—…ì²´ëª…:</strong> ë†ì—…íšŒì‚¬ë²•ì¸ãˆœìœ¡êµ¬ì´</p>
                    <p><strong>ì†Œì¬ì§€:</strong> ê²½ê¸°ë„ ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬ ë°•ë‹¬ë¡œ 298, í˜‘ì‹ ì‹í’ˆ ë‚˜ë™ ì§€í•˜1ì¸µ</p>
                    <p style="position:relative; overflow:visible;"><strong>ëŒ€í‘œì:</strong> ê¹€ìš°í˜•, ê¹€ë¯¼ì„œ <span style="float:right; position:relative; display:inline-block; text-align:center;">${stampImageData ? `<img src="${stampImageData}" style="width:80px; height:80px; position:absolute; top:-30px; left:50%; transform:translateX(calc(-50% - 40px)); z-index:1;">` : ''}<span style="position:relative; z-index:2;">(ì„œëª…/ì¸)</span></span></p>
                </div>

                <div style="margin-top:15px;">
                    <p><strong>(ì„) ì£¼ì†Œ:</strong> <span style="display:inline-block; width: 300px; border-bottom: 1px solid #333;"></span></p>
                    <p><strong>ì—°ë½ì²˜:</strong> <span style="display:inline-block; width: 150px; border-bottom: 1px solid #333;"></span></p>
                    <p><strong>ì„±ëª…:</strong> ${name} <span style="float:right;">(ì„œëª…/ì¸)</span></p>
                </div>

                <div class="print-btn-area" style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-success" style="padding: 12px 40px; font-size: 16px;" onclick="window.print()">PDF ì¶œë ¥ (ì¸ì‡„)</button>
                </div>
            </div>
            `;

            document.getElementById('contractPreviewArea').innerHTML = previewHtml;
        }

        function printContract() {
            generateContract();
            window.print();
        }

        function toggleEndDate() {
            const checkbox = document.getElementById('noEndDate');
            const endDateInput = document.getElementById('contractEndDate');
            if (checkbox.checked) {
                endDateInput.disabled = true;
                endDateInput.value = '';
            } else {
                endDateInput.disabled = false;
            }
        }

        // ìˆ«ì ì…ë ¥ í•„ë“œ í¬ë§·íŒ…
        function formatInputNumber(input) {
            let value = input.value.replace(/,/g, '');
            if (value && !isNaN(value)) {
                input.value = parseInt(value).toLocaleString('ko-KR');
            }
        }

        const numericInputs = ['contractSalary', 'mealAllowance', 'vehicleAllowance', 'childcareAllowance', 'researchAllowance', 'dailyMealCost', 'minimumWage', 'modalNewSalary', 'editHistorySalary', 'historyHireSalary'];

        // ë„ì¥ ì´ë¯¸ì§€ ê´€ë¦¬
        let stampImageData = localStorage.getItem('stampImage') || '';

        function handleStampUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                stampImageData = e.target.result;
                localStorage.setItem('stampImage', stampImageData);
                updateStampPreview();
                alert('ë„ì¥ ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            };
            reader.readAsDataURL(file);
            event.target.value = '';
        }

        function removeStamp() {
            if (!stampImageData) {
                alert('ë“±ë¡ëœ ë„ì¥ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            if (confirm('ë„ì¥ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                stampImageData = '';
                localStorage.removeItem('stampImage');
                updateStampPreview();
                alert('ë„ì¥ ì´ë¯¸ì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        function updateStampPreview() {
            const preview = document.getElementById('stampPreview');
            if (stampImageData) {
                preview.innerHTML = `<img src="${stampImageData}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
            } else {
                preview.innerHTML = '<span style="color: #999; font-size: 12px; text-align: center;">ë„ì¥ ì—†ìŒ</span>';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            numericInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    if (input.value) formatInputNumber(input);
                    input.addEventListener('blur', function() { formatInputNumber(this); });
                    input.addEventListener('focus', function() { this.value = this.value.replace(/,/g, ''); });
                    input.type = 'text';
                    input.inputMode = 'numeric';
                }
            });

            // ë„ì¥ ì´ë¯¸ì§€ ë¶ˆëŸ¬ì˜¤ê¸°
            updateStampPreview();
        });

        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') calculate();
        });
    </script>
</body>
</html>
